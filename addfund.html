<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Add Funds</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:system-ui}

body{
  min-height:100vh;
  background:
    radial-gradient(circle at 20% 20%,#00f2ff22,transparent 40%),
    radial-gradient(circle at 80% 80%,#00ff8822,transparent 40%),
    linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:#fff;
}

/* TOPBAR */
.topbar{
  height:70px;
  flex-shrink:0;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 20px;
  background:rgba(0,0,0,.4);
  backdrop-filter:blur(10px);
}

.title{
  font-size:22px;
  font-weight:900;
  color:#00ffcc;
}

.back{cursor:pointer}

/* MAIN AREA */
.main{
  flex:1;
  display:flex;
  flex-direction:column;
  padding:20px;
  overflow:hidden; /* ðŸ”¥ Main bhi fixed */
}

/* CARD */
.card{
  background:rgba(255,255,255,.08);
  backdrop-filter:blur(15px);
  border-radius:20px;
  padding:20px;
  margin-bottom:15px;
  box-shadow:0 15px 40px rgba(0,0,0,.5);
}

/* QR */
.qr{
  width:170px;
  margin:10px auto;
  display:block;
  border-radius:15px;
  box-shadow:0 0 25px #00eaff;
}

input{
  width:100%;
  padding:14px;
  margin:10px 0;
  border:none;
  border-radius:18px;
  background:#003545;
  color:#fff;
}

button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:25px;
  font-weight:900;
  background:linear-gradient(90deg,#00f2ff,#00ff88);
  cursor:pointer;
}

button:disabled{
  opacity:.6;
  cursor:not-allowed;
}

/* ðŸ”¥ HISTORY CARD FLEX */
.historyWrapper{
  overflow-x:auto;
}

/* ðŸ”¥ ONLY THIS SCROLL */
.historyWrapper{
  flex:1;
  overflow-y:auto;
  overflow-x:hidden;
}

/* TABLE */
table{
  width:100%;
  border-collapse:collapse;
}

th,td{
  padding:10px;
  text-align:center;
  font-size:14px;
}

th{
  background:#00eaff33;
  position:sticky;
  top:0;
}

.status{
  padding:6px 14px;
  border-radius:20px;
  font-weight:700;
  display:inline-block;
  animation:fadeIn .4s ease;
}

@keyframes fadeIn{
  from{opacity:0;transform:scale(.9)}
  to{opacity:1;transform:scale(1)}
}

.pending{
  color:#ffaa00;
  background:#ffaa0022;
  box-shadow:0 0 10px #ffaa00;
}

.approved{
  color:#00ff88;
  background:#00ff8822;
  box-shadow:0 0 12px #00ff88;
}

.credited{
  color:#00eaff;
  background:#00eaff22;
  box-shadow:0 0 12px #00eaff;
}

.rejected{
  color:#ff4444;
  background:#ff444422;
  box-shadow:0 0 12px #ff4444;
}
</style>
</head>

<body>

<div class="topbar">
  <div class="title">Add Funds</div>
  <div class="back" onclick="window.location='home.html'">â¬… Home</div>
</div>

<div class="main">

<div class="card">
<h3>Scan & Pay</h3>

<img src="qr.png" class="qr">

<p>UPI ID: <b>ravikishanm90@fam</b></p>

<input id="amount" type="number" placeholder="Enter Amount (Min â‚¹10)">
<input id="utr" placeholder="Enter UTR / Transaction ID">

<button id="submitBtn" onclick="submitPayment()">Submit Payment</button>

<p id="msg"></p>
</div>

<div class="card historyCard">
<h3>Payment History</h3>

<div class="historyWrapper">
<table>
<thead>
<tr>
<th>Amount</th>
<th>UTR</th>
<th>Status</th>
<th>Date</th>
</tr>
</thead>
<tbody id="paymentTable">
<tr><td colspan="4">Loading...</td></tr>
</tbody>
</table>
</div>

</div>

</div>

<script>
const API_URL="https://script.google.com/macros/s/AKfycby0UHijonDZaPPVyGpjKsAsc9OUTJusetjoQMwygHmiwPd7otW7B1p0D_oIwmuh5rIbIw/exec";
const userID=localStorage.getItem("userID");
if(!userID){ window.location="index.html"; }

function submitPayment(){
  const amount=document.getElementById("amount").value;
  const utr=document.getElementById("utr").value.trim();
  const msg=document.getElementById("msg");
  const btn=document.getElementById("submitBtn");

  if(!amount || amount<10){ msg.innerText="Minimum â‚¹10 required"; return; }
  if(!utr){ msg.innerText="Enter valid UTR"; return; }

  btn.disabled=true;
  btn.innerText="Submitting...";

  fetch(API_URL,{
    method:"POST",
    body:JSON.stringify({
      action:"addPayment",
      userID:userID,
      amount:amount,
      utr:utr
    })
  })
  .then(r=>r.json())
  .then(d=>{
    msg.innerText="Payment Submitted âœ…";
    document.getElementById("amount").value="";
    document.getElementById("utr").value="";
    loadPayments();
  });
}

function loadPayments(){
  fetch(API_URL,{
    method:"POST",
    body:JSON.stringify({
      action:"getPayments",
      userID:userID
    })
  })
  .then(r=>r.json())
  .then(d=>{
    const table=document.getElementById("paymentTable");
    table.innerHTML="";

    if(!d.payments || d.payments.length==0){
      table.innerHTML="<tr><td colspan='4'>No Payments</td></tr>";
      return;
    }

    d.payments.forEach(p=>{
      let statusClass="pending";
      if(p.status==="Approved") statusClass="approved";
      if(p.status==="Credited") statusClass="credited";

      table.innerHTML+=`
      <tr>
        <td>â‚¹${p.amount}</td>
        <td>${p.utr}</td>
        <td><span class="status ${statusClass}">${p.status}</span></td>
        <td>${new Date(p.date).toLocaleDateString()}</td>
      </tr>`;
    });
  });
}

loadPayments();
</script>

</body>
</html>