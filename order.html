<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>New Order â€¢ Social Growth</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;font-family:system-ui,-apple-system}
body{
  margin:0;
  min-height:100vh;
  background:radial-gradient(circle at top,#1a3c4a,#0f2027 70%);
  color:#fff;
  overflow-x:hidden;
}

/* Glow Background */
body::before{
  content:"";
  position:fixed;
  width:500px;
  height:500px;
  background:radial-gradient(circle,#00f2ff55,transparent 60%);
  top:-150px;
  left:-150px;
  animation:glow 8s infinite alternate;
}
@keyframes glow{
  from{transform:translate(0,0)}
  to{transform:translate(200px,150px)}
}

.topbar{
  height:60px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 18px;
  background:rgba(0,0,0,.5);
  backdrop-filter:blur(14px);
}
.brand{
  font-size:20px;
  font-weight:900;
  background:linear-gradient(135deg,#00eaff,#00ff88);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}
.back{cursor:pointer;}

.container{
  padding:22px;
  animation:fadeIn .7s ease;
}
@keyframes fadeIn{
  from{opacity:0;transform:translateY(20px)}
  to{opacity:1}
}

.card{
  background:rgba(255,255,255,.08);
  backdrop-filter:blur(20px);
  border-radius:26px;
  padding:25px;
  box-shadow:0 25px 60px rgba(0,0,0,.5);
}

label{font-size:13px;opacity:.8}
select,input{
  width:100%;
  padding:14px;
  margin:8px 0 16px;
  border:none;
  border-radius:16px;
  outline:none;
  background:rgba(255,255,255,.12);
  color:#fff;
}
select option{color:#000}

.priceBox{
  font-size:30px;
  font-weight:900;
  background:linear-gradient(135deg,#00eaff,#00ff88);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  text-shadow:0 0 25px rgba(0,255,200,.6);
  margin:12px 0;
}

button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:20px;
  font-weight:900;
  background:linear-gradient(135deg,#00eaff,#00ff88);
  color:#000;
  cursor:pointer;
  box-shadow:0 0 30px rgba(0,255,200,.8);
}

.msg{
  text-align:center;
  margin-top:15px;
  font-weight:600;
}
</style>
</head>

<body>

<div class="topbar">
  <div class="brand">New Order ðŸš€</div>
  <div class="back" onclick="window.location='home.html'">â¬… Home</div>
</div>

<div class="container">
<div class="card">

<label>Service</label>
<select id="service"></select>

<label>Instagram Link</label>
<input id="link" placeholder="Paste link">

<label>Quantity</label>
<input id="qty" type="number" oninput="calcPrice()">

<div class="priceBox">â‚¹ <span id="price">0</span></div>

<button onclick="submitOrder()">Submit Order</button>

<div class="msg" id="msg"></div>

</div>
</div>

<script>

const API_URL="https://script.google.com/macros/s/AKfycby0UHijonDZaPPVyGpjKsAsc9OUTJusetjoQMwygHmiwPd7otW7B1p0D_oIwmuh5rIbIw/exec";

const userID=localStorage.getItem("userID");

if(!userID){
  window.location="index.html";
}

let balance=0;
let rate=0,min=0,max=0,serviceName="";

/* LOAD USER BALANCE */
fetch(API_URL,{
  method:"POST",
  body:JSON.stringify({
    action:"getUser",
    userID:userID
  })
})
.then(r=>r.json())
.then(d=>{
  if(d.ok){
    balance=parseFloat(d.balance);
  }
});

/* LOAD SERVICES FROM SERVICE SHEET */
fetch(API_URL,{
  method:"POST",
  body:JSON.stringify({
    action:"getServices"
  })
})
.then(r=>r.json())
.then(d=>{
  const select=document.getElementById("service");
  select.innerHTML="<option disabled selected>Select Service</option>";

  d.services.forEach(s=>{
    select.innerHTML+=`
      <option value="${s.name}|${s.rate}|${s.min}|${s.max}">
        ${s.name} (â‚¹${s.rate} / 1000)
      </option>`;
  });
});

/* SERVICE SELECT */
document.getElementById("service").addEventListener("change",function(){
  let data=this.value.split("|");
  serviceName=data[0];
  rate=parseFloat(data[1]);
  min=parseInt(data[2]);
  max=parseInt(data[3]);
  calcPrice();
});

function calcPrice(){
  let q=parseInt(qty.value)||0;
  if(q<min || q>max){
    price.innerText="0";
    return;
  }
  let total=(q/1000)*rate;
  price.innerText=total.toFixed(2);
}

function submitOrder(){

  let q=parseInt(qty.value)||0;
  let total=parseFloat(price.innerText);

  if(!serviceName) return showMsg("Select service");
  if(!link.value) return showMsg("Enter link");
  if(q<min || q>max) return showMsg("Invalid quantity");
  if(total>balance) return showMsg("Insufficient balance");

  fetch(API_URL,{
    method:"POST",
    body:JSON.stringify({
      action:"placeOrder",
      userID:userID,
      service:serviceName,
      quantity:q,
      price:total
    })
  })
  .then(r=>r.json())
  .then(d=>{
    if(d.ok){
      balance-=total;
      showMsg("Order Placed Successfully âœ…",true);
      qty.value="";
      price.innerText="0";
    }else{
      showMsg(d.msg);
    }
  });
}

function showMsg(text,success=false){
  msg.innerText=text;
  msg.style.color=success?"#00ff88":"#ff4d4d";
}

</script>

</body>
</html>
